{% extends "layout.html" %}
{% block body %}

<br>
<div class="col-md-4 col-md-offset-4 text-center">
  <a href="qaqc_help">
    <p style="font: 20px sans-serif">Instructions Here</p>
  </a>
</div>
<br><br><br>

<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <p class="text-muted">
      Note: if you suspect that you're seeing an old version of this app, delete
      cookies and clear your web cache.
      <a href="https://www.thewindowsclub.com/clear-cache-cookies-specific-website"
      target="_bank" rel="noopener noreferrer">
        Here's how
      </a>
      to do that for a specific website using Chrome or Firefox. Reload this
      page when you're done.
    </p>
    <p>
      <strong>Also note</strong>: Points you've just flagged may revert to default blue if
      you switch back-and-forth between time ranges. Don't worry. The flag information
      is still in the system. The points will appear as flagged the next time you
      load the page.
    </p>
  </div>
</div>
<br>

<div class="row" id="flagging">

<div class="row text-center">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="form-inline">
        Show local night-time: <input type="checkbox" id="shownight" value="no"> &nbsp;
        Compare variable: <select class="form-control" id="backgraphlist2" name="backgraphlist2"></select>
        <br>
        <button class="btn btn-link" type="button" id="zoomreset">Reset zoom</button>
        (or double-click any plot to reset zoom)
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-4 text-left">
      <button class="btn btn-link" type="button" id="panback">
        << Previous two weeks
      </button>
    </div>
    <div class="col-md-4 text-center">
      <p>Jump to date range: </p>
      <select class="form-control" id="jumptodate" name="jumptodate">
      </select>
    </div>
    <div class="col-md-4 text-right">
      <button class="btn btn-link" type="button" id="panforward">
        <!-- Next four weeks >> -->
      </button>
    </div>
  </div>
</div>

</div>


<div class="row" id="graphs"></div>
<br><br>

<!-- <form id="startpipeline" action="/qaqc_sensordata" method="GET" class="form-horizontal"> -->
<!-- <form id="submit_dataset" action="/submit_dataset/<tmpcode>" method="GET" class="form-horizontal">
  <div class="col-md-6 col-md-offset-3">
    <br><br>
    <button id="plbutton" type="submit" value=submit_dataset class="btn btn-primary btn-block">
      Submit
    </button>
  </div>
</form> -->

<button id='getpl' class="btn btn-primary" type="button">
  oi?
</button>

<script src="static/js/graphs.js"></script>
<script type="text/javascript" src="static/js/qaqc_helpers.js"></script>

<script type="text/javascript">

  var qaqc_options = '{{ qaqc_options|safe }}';

  var plotdates = {{ variables|safe }};
  var origdata = {{ origjson|safe }};
  var pldata = {{ pljson|safe }};
  var flagdata = {{ flagjson|safe }};
  var plotdates = {{ plotdates|safe }};
  var plotstart = plotdates[1];
  var plotend = plotdates[0];

  //generate plots and additional asynchronous options
  // $(function(){
  //   $("button[name=qaqcsite]").click(function(){
  //     var dat = {}
  //     dat['site'] = $('select[name=site]').val();
  //     dat['vars'] = $('#variables:checked').map(function() { return this.value; }).get();
  //     dat['year'] = $('#dyear').val();

      // $.ajax({
      //   type: 'POST',
      //   url:'/_getqaqc',
      //   data: JSON.stringify(dat),
      //   contentType: 'application/json;charset=UTF-8',
      //   success: function(response){
      //     $("#graphs").empty();
      //     plotdates = response.plotdates; // list of 4-week window boundaries
      //     alldata = JSON.parse(response.dat);
      //     plotstart = plotdates[1];
      //     plotend = plotdates[0];
  $(function(){
    $("#getpl").click(function(){

      origdisp = getdisplaydata(plotstart, plotend, origdata);
      pldisp = getdisplaydata(plotstart, plotend, pldata);

              //reformat plot dates as DD/MM/YYYY, remove leading zeros on D and M
      plotdates_reform = plotdates.slice(0) //copy mutable array
      for (var i = 0; i < plotdates_reform.length; ++i){
        splt = plotdates_reform[i].split('-')
        plotdates_reform[i] = splt[1].replace(/^0/, '') + '/' +
          splt[2].replace(/^0/, '') + '/' + splt[0]
      }

              // $.ajax({
              //   type: 'POST',
              //   url: '/_outlierdetect',
              //   data: JSON.stringify(data),
              //   contentType: 'application/json;charset=UTF-8',
              //   success: function(response2){
              //     outliers = response2.outliers;
              //     variables = response.variables;
              //     sundat = JSON.parse(response.sunriseset);
              //     sundat.forEach(function(d){
              //       d.rise = parseDate(d.rise);
              //       d.set = parseDate(d.set);
              //     });
              //     flags = JSON.parse(response.flagdat);
                  // flagtypes = JSON.parse(response.flagtypes);
      Plots(variables, origpdisp, pldisp, flagdisp, 'qaqc', undefined, 'sensor');
      // if($("#shownight").is(":checked")) { Sunlight(variables, sundat) };
      $('#flagging').show();

      //populate dropdown of potential comparison variables
      $('#backgraphlist2')
        .find('option').remove().end()
        .append('<option value="None" selected>None</option>');
      for (var i = 0; i < response.variables.length; ++i){
        $('#backgraphlist2').append('<option value="'+response.variables[i]+'">'+response.variables[i]+'</option>');
      }

      //populate dropdown of potential date ranges to jump to.
      //this part establishes the most recent range as the selected option
      default_range = plotdates_reform[1] + ' - ' + plotdates_reform[0]
      default_range_val = plotdates[1] + ' ' + plotdates[0]
      $('#jumptodate')
        .find('option').remove().end()
        .append('<option value="' + default_range_val +
          '" selected>' + default_range + '</option>');

      //and now the rest of the options
      for (var i = 1; i < plotdates_reform.length-1; ++i){
        daterange = plotdates_reform[i+1] + ' - ' + plotdates_reform[i]
        daterange_val = plotdates[i+1] + ' ' + plotdates[i]
        $('#jumptodate').append('<option value="' + daterange_val +
          '">' + daterange + '</option>');
      }

    })
  })

  //           },
  //           error: function(error){
  //             console.log(error);
  //           }
  //         });
  //
  //       },
  //       error: function(error){
  //         console.log(error);
  //       }
  //     });
  //     return false;
  //   })
  // });

</script>

{% endblock %}
